# Ansible Inventory File
# Smart Attendance Management System
# Defines target hosts and their groupings

---
all:
  # Define the main host (localhost for local deployment)
  hosts:
    localhost:
      # Use local connection instead of SSH
      ansible_connection: local

      # Python interpreter to use
      ansible_python_interpreter: /usr/bin/python3

      # Project variables specific to this host
      project_root: /opt/smart-attendance
      python_version: python3

  # Group services logically for targeted deployment
  children:
    # Core business logic services
    core_services:
      hosts:
        localhost:
      vars:
        service_list:
          - name: student-service
            port: 5001
            description: "Student management with Excel import"

          - name: course-service
            port: 5002
            description: "Course and enrollment management"

          - name: auth-service
            port: 5007
            description: "JWT authentication service"

    # Data processing services
    processing_services:
      hosts:
        localhost:
      vars:
        service_list:
          - name: attendance-service
            port: 5005
            description: "Attendance tracking with circuit breakers"

    # Infrastructure services
    infrastructure:
      hosts:
        localhost:
      vars:
        service_list:
          - name: api-gateway
            port: 5000
            description: "Central API gateway with JWT validation"

          - name: service-registry
            port: 5008
            description: "Service discovery and health monitoring"

  # Global variables for all hosts
  vars:
    # All services combined
    all_services:
      - name: student-service
        port: 5001
        health_endpoint: "/api/students/health"

      - name: course-service
        port: 5002
        health_endpoint: "/api/courses/health"

      - name: auth-service
        port: 5007
        health_endpoint: "/api/auth/health"

      - name: attendance-service
        port: 5005
        health_endpoint: "/api/attendance/health"

      - name: api-gateway
        port: 5000
        health_endpoint: "/"

      - name: service-registry
        port: 5008
        health_endpoint: "/services"

    # Common Python packages needed across services
    common_packages:
      - flask==3.0.0
      - flask-cors==4.0.0
      - python-dotenv==1.0.0
      - requests==2.31.0

    # Deployment settings
    deployment:
      max_retries: 3
      service_start_delay: 2
      health_check_timeout: 30
      health_check_retries: 5
